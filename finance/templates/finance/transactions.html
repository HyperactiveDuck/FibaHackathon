{% extends 'base.html' %}

{% block page_title %}Transactions{% endblock %}

{% block content %}
<!-- Header with filters -->
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
    <div style="display: flex; gap: 16px; align-items: center;">
        <select style="
            background-color: #111111;
            border: 1px solid #27272a;
            color: #e4e4e7;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
        ">
            <option>All Accounts</option>
            {% for account in accounts %}
            <option>{{ account.bank_name }} {{ account.get_account_type_display }}</option>
            {% endfor %}
        </select>
        
        <select style="
            background-color: #111111;
            border: 1px solid #27272a;
            color: #e4e4e7;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
        ">
            <option>Last 30 days</option>
            <option>Last 7 days</option>
            <option>Last 90 days</option>
            <option>This month</option>
            <option>Last month</option>
        </select>
        
        <select style="
            background-color: #111111;
            border: 1px solid #27272a;
            color: #e4e4e7;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
        ">
            <option>All Categories</option>
            <option>Food & Dining</option>
            <option>Shopping</option>
            <option>Transportation</option>
            <option>Bills & Utilities</option>
            <option>Entertainment</option>
        </select>
    </div>
    
    <button style="
        background-color: #22c55e;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.2s ease;
    " onmouseover="this.style.backgroundColor='#16a34a'" onmouseout="this.style.backgroundColor='#22c55e'">
        Export CSV
    </button>
</div>

<!-- Transaction Summary Cards - USING REAL DATA -->
<div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); margin-bottom: 32px;">
    <div class="card">
        <h3>Total Inflow</h3>
        <div class="metric-value metric-positive">â‚º{{ total_inflow|floatformat:2 }}</div>
        <p style="color: #a1a1aa; font-size: 12px; margin-top: 4px;">Income transactions</p>
    </div>
    
    <div class="card">
        <h3>Total Outflow</h3>
        <div class="metric-value metric-negative">â‚º{{ total_outflow|floatformat:2 }}</div>
        <p style="color: #a1a1aa; font-size: 12px; margin-top: 4px;">Expense transactions</p>
    </div>
    
    <div class="card">
        <h3>Net Change</h3>
        <div class="metric-value {% if net_change >= 0 %}metric-positive{% else %}metric-negative{% endif %}">
            {% if net_change >= 0 %}+{% endif %}â‚º{{ net_change|floatformat:2 }}
        </div>
        <p style="color: #a1a1aa; font-size: 12px; margin-top: 4px;">Balance change</p>
    </div>
    
    <div class="card">
        <h3>Total Transactions</h3>
        <div class="metric-value metric-neutral">{{ transaction_count }}</div>
        <p style="color: #a1a1aa; font-size: 12px; margin-top: 4px;">All time</p>
    </div>
</div>

<!-- Transactions List - USING REAL DATA -->
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
        <h3 class="section-title" style="margin-bottom: 0;">Recent Transactions</h3>
        <p style="color: #71717a; font-size: 12px;">Showing {{ transactions|length }} of {{ transaction_count }} transactions</p>
    </div>
    
    {% for transaction in transactions %}
    <!-- Transaction Item -->
    <div style="border-bottom: 1px solid #27272a; padding: 16px 0; display: flex; justify-content: space-between; align-items: center;">
        <div style="display: flex; align-items: center; gap: 16px;">
            <div style="
                width: 40px;
                height: 40px;
                background-color: {% if transaction.amount >= 0 %}#22c55e20{% else %}#ef444420{% endif %};
                border-radius: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 18px;
            ">
                {% if transaction.category == 'FOOD_DINING' %}ðŸ•
                {% elif transaction.category == 'SHOPPING' %}ðŸ›’
                {% elif transaction.category == 'TRANSPORTATION' %}ðŸš‡
                {% elif transaction.category == 'BILLS_UTILITIES' %}âš¡
                {% elif transaction.category == 'ENTERTAINMENT' %}ðŸŽ¬
                {% elif transaction.amount >= 0 %}ðŸ’°
                {% else %}ðŸ’³
                {% endif %}
            </div>
            <div>
                <h4 style="color: #fafafa; font-size: 14px; margin-bottom: 2px;">
                    {{ transaction.merchant|default:transaction.description }}
                </h4>
                <p style="color: #71717a; font-size: 12px;">
                    {% if transaction.category == 'FOOD_DINING' %}Food & Dining
                    {% elif transaction.category == 'SHOPPING' %}Shopping
                    {% elif transaction.category == 'TRANSPORTATION' %}Transportation
                    {% elif transaction.category == 'BILLS_UTILITIES' %}Bills & Utilities
                    {% elif transaction.category == 'ENTERTAINMENT' %}Entertainment
                    {% else %}{{ transaction.category }}
                    {% endif %}
                    â€¢ {{ transaction.account.bank_name }} {{ transaction.account.get_account_type_display }}
                </p>
                <p style="color: #71717a; font-size: 11px;">Transaction ID: {{ transaction.transaction_id }}</p>
            </div>
        </div>
        <div style="text-align: right;">
            <p style="color: {% if transaction.amount >= 0 %}#22c55e{% else %}#ef4444{% endif %}; font-size: 16px; font-weight: 600;">
                {% if transaction.amount >= 0 %}+{% endif %}â‚º{{ transaction.amount|floatformat:2 }}
            </p>
            <p style="color: #a1a1aa; font-size: 12px;">{{ transaction.date|date:"M j, Y H:i" }}</p>
            <span style="
                background-color: {% if transaction.amount >= 0 %}#22c55e20{% else %}#ef444420{% endif %};
                color: {% if transaction.amount >= 0 %}#22c55e{% else %}#ef4444{% endif %};
                padding: 2px 6px;
                border-radius: 4px;
                font-size: 10px;
                text-transform: uppercase;
            ">{% if transaction.amount >= 0 %}Credit{% else %}Debit{% endif %}</span>
        </div>
    </div>
    {% empty %}
    <div style="text-align: center; padding: 40px; color: #71717a;">
        <p>No transactions found</p>
    </div>
    {% endfor %}
    
    <!-- Load More Button -->
    {% if transaction_count > 40 %}
    <div style="text-align: center; margin-top: 24px;">
        <button style="
            background-color: #27272a;
            color: #e4e4e7;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
        " onmouseover="this.style.backgroundColor='#3f3f46'" onmouseout="this.style.backgroundColor='#27272a'">
            Load More Transactions
        </button>
    </div>
    {% endif %}
</div>
{% endblock %}